# ESP32 TCT Pipe — карта проекта

Этот файл фиксирует архитектуру проекта, чтобы её можно было восстановить
даже при потере контекста в диалоге или при смене среды.

---

## Точка входа

### main.pyw
- Единственная точка запуска
- Создаёт Tk root
- Инициализирует App (GUI)
- Никакой логики внутри

---

## GUI

### gui.py
- Главное окно приложения
- Notebook с вкладками:
  - Main
  - MQTT
- Вкладка Main:
  - IP1 / Port1
  - IP2 / Port2
  - Кнопка **Send MQTT**
  - Лог (ScrolledText)
- Вкладка MQTT:
  - Broker
  - Port
  - Topic
  - Login / Password
  - Apply / Reconnect
- Все поля подтягиваются из history.json
- GUI НЕ запускает Node и Chrome напрямую

---

## Менеджеры

### mqtt_manager.py
- Управляет MQTT подключением
- Использует последние значения с вкладки MQTT
- Apply / Reconnect:
  - пересоздаёт MQTT client
- Send MQTT:
  - публикует payload
  - подтверждает, что данные реально появились в топике

### node_manager.py
- Управляет процессом Node.js
- Гарантирует:
  - один сервер
  - один порт
  - отсутствие EADDRINUSE
- Читает stdout / stderr в UTF-8
- Передаёт лог в GUI

### chrome_manager.py
- Управляет запуском Chrome
- Открывает браузер ТОЛЬКО после:
  - успешной отправки MQTT
  - готовности Node.js
- Использует временный профиль
- Защищён от многократного открытия

---

## Хранилища и утилиты

### history_store.py
- Читает и пишет history.json
- Хранит последние значения всех полей
- Используется всеми вкладками

### config.py
- Все константы проекта:
  - размеры окна
  - позиции
  - пути
  - тайминги

### utils.py
- Вспомогательные функции
- Без логики приложения

---

## Node.js

### server.js
- TCP bridge сервер
- Принимает ESP32
- Принимает браузер
- Передаёт данные между ними
- Печатает SERVER_READY после listen()

---

## Принципы проекта

- GUI ничего не запускает напрямую
- Все действия идут через менеджеры
- Никакой магии
- Один процесс = один порт
- Всё логируется
